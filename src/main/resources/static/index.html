<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>game-hub/Mahe</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <style>
        .hidden { display: none !important; }
        .game-layout { display: flex; gap: 20px; height: 700px; margin-top: 10px; }
        .game-stage { flex: 3; background-color: var(--box-bg); border: 1px solid var(--border-color); border-radius: 6px; position: relative; overflow: hidden; }
        .chat-container { flex: 1; display: flex; flex-direction: column; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--box-bg); min-width: 280px; }
        #messages { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; }

        .mahe-board {
            width: 100%; height: 100%;
            background-color: var(--bg-body);
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; flex-direction: column;
            padding: 15px; box-sizing: border-box;
            color: var(--text-primary);
            overflow-y: auto;
        }

        .egg-info-area {
            background: var(--bg-header);
            border: 1px solid var(--border-color);
            padding: 12px 20px;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        .egg-card { font-size: 20px; font-weight: bold; }
        .egg-card.bonus { color: var(--link-color); }
        .deck-count { font-size: 14px; color: var(--text-secondary); }

        .players-panel {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-header);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .player-card {
            background: var(--box-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            min-width: 100px;
            text-align: center;
        }
        .player-card.active-turn {
            border-color: var(--link-color);
            box-shadow: 0 0 0 2px var(--link-color);
        }
        .player-card.is-me { background: var(--bg-header); }
        .player-name { font-weight: bold; font-size: 13px; margin-bottom: 3px; }
        .player-score { font-size: 11px; color: var(--text-secondary); }
        .player-pos { font-size: 10px; color: var(--text-secondary); margin-top: 2px; }
        .player-turtle { font-size: 24px; }

        .track-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px; }
        .track {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
            max-width: 700px;
            background: var(--bg-header);
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 6px;
        }
        .track-cell {
            width: 48px; height: 55px;
            background: var(--box-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 3px;
            font-size: 10px;
            color: var(--text-primary);
            position: relative;
        }
        .track-cell.raft {
            background: var(--bg-header);
            border: 2px dashed var(--border-color);
            width: 55px;
        }
        .track-cell.finish {
            background: var(--bg-header);
            border: 2px solid var(--link-color);
        }
        .cell-number { font-weight: bold; font-size: 12px; }
        .cell-label { font-size: 9px; margin-top: 2px; color: var(--text-secondary); }

        .turtle-stack { position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); }
        .turtle { font-size: 18px; position: relative; }
        .turtle.active { animation: turtleBounce 0.5s infinite; }
        @keyframes turtleBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        /* ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes diceShake {
            0% { transform: rotate(0deg) scale(1); }
            20% { transform: rotate(-15deg) scale(1.1); }
            40% { transform: rotate(15deg) scale(1.1); }
            60% { transform: rotate(-10deg) scale(1.05); }
            80% { transform: rotate(10deg) scale(1.05); }
            100% { transform: rotate(0deg) scale(1); }
        }

        @keyframes diceSpin {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            25% { transform: rotateY(90deg) rotateX(90deg); }
            50% { transform: rotateY(180deg) rotateX(180deg); }
            75% { transform: rotateY(270deg) rotateX(270deg); }
            100% { transform: rotateY(360deg) rotateX(360deg); }
        }

        @keyframes diceBounce {
            0%, 100% { transform: translateY(0); }
            30% { transform: translateY(-20px) rotate(10deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
            70% { transform: translateY(-5px) rotate(3deg); }
        }

        .dice {
            width: 45px; height: 45px;
            background: var(--box-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--text-primary);
            animation: diceAppear 0.5s ease;
        }

        .dice.rolling {
            animation: diceSpin 0.3s ease-in-out 3, diceShake 0.5s ease-in-out;
        }

        .dice.new {
            animation: diceBounce 0.6s ease-out, diceShake 0.4s ease-in-out;
        }

        @keyframes diceAppear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(-10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .control-area {
            background: var(--bg-header);
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .dice-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            min-height: 50px;
            flex-wrap: wrap;
        }
        .dice {
            width: 45px; height: 45px;
            background: var(--box-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--text-primary);
        }
        .dice-info { font-size: 14px; color: var(--link-color); font-weight: bold; }

        .action-btns { display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .turn-message { font-size: 14px; color: var(--link-color); min-height: 20px; }

        .btn-game {
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }
        .btn-game:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-roll { background: var(--btn-primary-bg); color: var(--btn-primary-text); border: none; }
        .btn-stop { background: var(--box-bg); color: var(--text-primary); }

        .rules-hint {
            position: absolute;
            top: 10px; right: 10px;
            background: var(--bg-header);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 10px;
            color: var(--text-secondary);
            max-width: 180px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<header>
    <div class="repo-breadcrumb">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="30" style="border-radius:50%;">
        <a href="/static" class="user-name">game-hub</a>
        <span style="color:var(--text-primary)">/</span>
        <a href="#" class="repo-name">Mahe</a>
        <span class="badge">Public</span>
    </div>
    <div style="display: flex; gap: 8px; align-items: center; margin-left: auto;">
        <div id="loggedInArea" class="hidden" style="display: flex; align-items: center; gap: 8px;">
            <span style="color: var(--text-primary); font-size: 14px;">ğŸ‘‹ <b id="userNickname">User</b></span>
            <button class="btn-default" onclick="Core.logout()" style="padding: 4px 8px; font-size: 12px;">Sign out</button>
        </div>
        <button class="theme-btn" onclick="Core.toggleTheme()">Dark/Light</button>
    </div>
</header>

<div id="alert-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:10000;">
    <div class="box" style="width:320px; margin: 0;">
        <div class="box-header">ì•Œë¦¼</div>
        <div style="padding: 20px; text-align: center;"><p id="alert-msg-text" style="margin:0;">ë©”ì‹œì§€</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);">
            <button class="btn-primary" onclick="Core.closeAlert()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="confirm-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:10000;">
    <div class="box" style="width:320px; margin: 0;">
        <div class="box-header">í™•ì¸</div>
        <div style="padding: 20px; text-align: center;"><p id="confirm-msg-text" style="margin:0;">ì§„í–‰?</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); display:flex; gap:10px;">
            <button class="btn-default" onclick="Core.closeConfirm()" style="flex:1;">ì·¨ì†Œ</button>
            <button class="btn-primary" onclick="Core.confirmOk()" style="flex:1;">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="login-screen" class="container" style="max-width: 400px; margin-top: 50px;">
    <div class="box">
        <div class="box-header">ğŸ¢ ë§ˆí—¤ - ê±°ë¶ì´ ê²½ì£¼</div>
        <div style="padding: 20px;">
            <label style="display:block; margin-bottom:8px; font-weight:600;">ë‹‰ë„¤ì„</label>
            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="if(event.key==='Enter') Core.login()">
            <button class="btn-primary" onclick="Core.login()" style="width:100%; margin-top:16px;">ì…ì¥í•˜ê¸°</button>
            <div style="margin-top: 15px; padding: 10px; background: var(--bg-header); border-radius: 6px; font-size: 11px; color: var(--text-secondary);">
                <strong>ê²Œì„ ê·œì¹™:</strong><br>
                â€¢ ì£¼ì‚¬ìœ„ ìµœëŒ€ 3ë²ˆ (ì²« ë²ˆì§¸ í•„ìˆ˜)<br>
                â€¢ í•© â‰¤ 7 ìœ ì§€ (8 ì´ìƒ = ë²„ìŠ¤íŠ¸)<br>
                â€¢ ì´ë™ = í•© Ã— ì£¼ì‚¬ìœ„ ê°œìˆ˜<br>
                â€¢ 21ì¹¸ ë„ë‹¬ â†’ ì•Œ ì¹´ë“œ íšë“<br>
                â€¢ ê°™ì€ ì¹¸ = ì—…ê¸° (ìœ„ê°€ ê²°ì •ê¶Œ)
            </div>
        </div>
    </div>
</div>

<div id="lobby-screen" class="container hidden">
    <div class="box">
        <div class="box-header">ëŒ€ê¸°ì‹¤ <span id="welcome-msg" style="font-size:12px; font-weight:normal;"></span></div>
        <div style="padding: 16px; display:flex; gap:10px;">
            <input type="text" id="roomNameInput" placeholder="ë°© ì œëª©" value="ë§ˆí—¤ ê²Œì„ë°©" style="flex:2;">
            <button class="btn-primary" onclick="Core.createRoom()">ë°© ë§Œë“¤ê¸°</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <div style="padding: 10px 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between;">
                <span>ë°© ëª©ë¡</span>
                <button class="btn-default" onclick="Core.loadRooms()" style="font-size:12px;"><i class="fas fa-sync-alt"></i></button>
            </div>
            <ul id="room-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
    </div>
</div>

<div id="game-screen" class="container hidden">
    <div style="display:flex; justify-content:space-between; margin-bottom:16px; align-items:center;">
        <div style="display:flex; align-items:center; gap:8px;">
            <strong id="room-title-text" style="font-size: 18px;">ë°© ì œëª©</strong>
            <span id="game-status" class="badge">ëŒ€ê¸° ì¤‘</span>
        </div>
        <div>
            <button id="startBtn" class="btn-primary" onclick="Core.startGame()">ê²Œì„ ì‹œì‘</button>
            <button class="btn-danger" onclick="Core.exitRoom()">ë‚˜ê°€ê¸°</button>
        </div>
    </div>

    <div class="game-layout">
        <div id="game-stage" class="game-stage">
            <div id="mahe-board" class="mahe-board hidden">
                <div class="rules-hint">
                    ğŸ² ì£¼ì‚¬ìœ„: ìµœëŒ€ 3ë²ˆ<br>
                    âš ï¸ í•© â‰¤ 7 (8+ = ë²„ìŠ¤íŠ¸)<br>
                    ğŸ“ ì´ë™ = í•© Ã— ê°œìˆ˜
                </div>

                <div id="egg-info" class="egg-info-area">
                    <span class="egg-card">ğŸ¥š ?ì </span>
                    <span class="deck-count">ë‚¨ì€ ì¹´ë“œ: ?ì¥</span>
                </div>

                <div id="players-panel" class="players-panel"></div>

                <div class="track-area">
                    <div id="track" class="track"></div>
                </div>

                <div class="control-area">
                    <div id="dice-display" class="dice-display">
                        <span style="color: var(--text-secondary);">ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì„¸ìš”!</span>
                    </div>
                    <div id="action-btns" class="action-btns" style="visibility: hidden;">
                        <button id="roll-btn" class="btn-game btn-roll" onclick="Mahe.roll()">ğŸ² êµ´ë¦¬ê¸°</button>
                        <button id="stop-btn" class="btn-game btn-stop" onclick="Mahe.stop()">âœ‹ ë©ˆì¶”ê¸°</button>
                    </div>
                    <div id="turn-message" class="turn-message"></div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="box-header" style="padding:10px;">ğŸ’¬ ì±„íŒ…</div>
            <div id="messages"></div>
            <div style="padding: 10px; border-top: 1px solid var(--border-color); display:flex; gap:8px;">
                <button class="btn-default" onclick="Core.openImageModal()" style="padding: 0 8px; margin-right:5px;" title="ì´ë¯¸ì§€ ì „ì†¡">
                    <i class="fas fa-images"></i>
                </button>

                <input type="text" id="chatInput" placeholder="ì…ë ¥..." onkeypress="if(event.key==='Enter') Core.sendChat()">
                <button class="btn-primary btn-send" onclick="Core.sendChat()">ì „ì†¡</button>
            </div>
            <div id="image-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; display:flex; justify-content:center; align-items:center;">
                <div class="box" style="width: 500px; height: 600px; display:flex; flex-direction:column; background:var(--box-bg); padding:0; margin:0;">

                    <div style="padding:15px; border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; align-items:center; gap: 15px;">
                            <strong style="font-size: 1.1em;">ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬</strong>

                            <label style="cursor: pointer; user-select: none; font-size: 13px; color: var(--text-secondary); display:flex; align-items:center; white-space: nowrap;">
                                <input type="checkbox" id="starFilterCheckbox" onchange="Core.loadImages()" style="margin-right: 5px;">
                                <span>â˜… ì¦ê²¨ì°¾ê¸°ë§Œ</span>
                            </label>
                        </div>

                        <button onclick="Core.closeImageModal()" style="background:none; border:none; color:var(--text-primary); cursor:pointer; font-size:1.5em; line-height:1;">&times;</button>
                    </div>

                    <div style="padding:15px; border-bottom:1px solid var(--border-color); background:rgba(0,0,0,0.02);">
                        <div style="display:flex; gap:5px; margin-bottom:10px;">
                            <input type="text" id="linkInput" placeholder="ì´ë¯¸ì§€ ì£¼ì†Œ(URL) ë¶™ì—¬ë„£ê¸°" style="flex:1; padding:8px; border:1px solid var(--border-color); border-radius:4px;">
                            <button class="btn-primary" onclick="Core.addExternalLink()" style="width:80px;">ë“±ë¡</button>
                        </div>

                        <input type="file" id="uploadInput" accept="image/*" style="display:none;" onchange="Core.uploadFile(this)">
                        <button class="btn-default" onclick="document.getElementById('uploadInput').click()" style="width:100%; padding:8px; border:1px dashed var(--text-secondary); color: var(--text-secondary);">
                            <i class="fas fa-plus"></i> ë‚´ ì»´í“¨í„°ì—ì„œ ì—…ë¡œë“œ
                        </button>
                    </div>

                    <div id="gallery-area" style="flex:1; padding:15px; overflow-y:auto; background: var(--box-bg);">
                        <div id="server-img-list" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;">
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div id="ranking-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:999;">
    <div class="box" style="width:360px; text-align: center;">
        <div class="box-header">ğŸ† ê²Œì„ ê²°ê³¼</div>
        <div style="padding: 30px 20px;">
            <div style="font-size:50px; margin-bottom:10px;">ğŸ¢</div>
            <div id="winnerName" style="font-size:20px; font-weight:bold;">WINNER</div>
            <div id="winnerScore" style="font-size:16px; color:var(--text-secondary); margin-top:5px;"></div>
        </div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);"><button class="btn-primary" onclick="Core.closeRanking()" style="width: 100%;">í™•ì¸</button></div>
    </div>
</div>

<script src="/mahe/js/game-core.js"></script>
<script src="/mahe/js/mahe.js"></script>

</body>
</html>